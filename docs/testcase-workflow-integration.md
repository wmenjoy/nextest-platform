# æµ‹è¯•æ¡ˆä¾‹ä¸å·¥ä½œæµé›†æˆè®¾è®¡

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-11-21
**ä½œè€…**: æµ‹è¯•æ¡†æ¶å›¢é˜Ÿ

---

## ç›®å½•

1. [è®¾è®¡ç›®æ ‡](#è®¾è®¡ç›®æ ‡)
2. [æ ¸å¿ƒè®¾è®¡åŸåˆ™](#æ ¸å¿ƒè®¾è®¡åŸåˆ™)
3. [ä¸‰ç§é›†æˆæ¨¡å¼](#ä¸‰ç§é›†æˆæ¨¡å¼)
4. [æ•°æ®æ¨¡å‹è®¾è®¡](#æ•°æ®æ¨¡å‹è®¾è®¡)
5. [APIè®¾è®¡](#apiè®¾è®¡)
6. [æ‰§è¡Œå¼•æ“æ”¹é€ ](#æ‰§è¡Œå¼•æ“æ”¹é€ )
7. [å‰ç«¯UIè®¾è®¡](#å‰ç«¯uiè®¾è®¡)
8. [è¿ç§»æ–¹æ¡ˆ](#è¿ç§»æ–¹æ¡ˆ)

---

## è®¾è®¡ç›®æ ‡

### æ ¸å¿ƒé—®é¢˜

**ç”¨æˆ·éœ€æ±‚**: "æµ‹è¯•æ¡ˆä¾‹çš„é…ç½®è¦èƒ½å…¼å®¹å·¥ä½œæµï¼Œæµ‹è¯•ç®¡ç†å·¥å…·ä¸ä»…ç®¡ç†æ¡ˆä¾‹ï¼Œæ¡ˆä¾‹è¿˜èƒ½çœŸæ­£çš„å®æ–½èµ·æ¥"

**è®¾è®¡ç›®æ ‡**:
1. âœ… æµ‹è¯•æ¡ˆä¾‹å¯ä»¥æ˜¯å·¥ä½œæµï¼ˆå¤æ‚çš„å¤šæ­¥éª¤æµ‹è¯•ï¼‰
2. âœ… å·¥ä½œæµå¯ä»¥å¼•ç”¨æµ‹è¯•æ¡ˆä¾‹ï¼ˆå¤ç”¨å·²æœ‰æµ‹è¯•ï¼‰
3. âœ… ç»Ÿä¸€çš„æµ‹è¯•ç®¡ç†ç•Œé¢ï¼ˆåˆ—è¡¨ã€æ‰§è¡Œã€ç»“æœã€å†å²ï¼‰
4. âœ… ç»Ÿä¸€çš„æ‰§è¡Œå¼•æ“ï¼ˆæ— è®ºæ˜¯å•ä¸€æµ‹è¯•è¿˜æ˜¯å·¥ä½œæµï¼‰
5. âœ… ä¿æŒå‘åå…¼å®¹ï¼ˆä¸å½±å“ç°æœ‰æµ‹è¯•æ¡ˆä¾‹ï¼‰

### ä¸šåŠ¡ä»·å€¼

| è§’è‰² | ä»·å€¼ |
|------|------|
| **QAå·¥ç¨‹å¸ˆ** | åœ¨æµ‹è¯•æ¡ˆä¾‹åˆ—è¡¨ä¸­ç›´æ¥ç®¡ç†å¤æ‚çš„ç«¯åˆ°ç«¯æµ‹è¯•æµç¨‹ |
| **è‡ªåŠ¨åŒ–å·¥ç¨‹å¸ˆ** | å¯ä»¥å°†å·¥ä½œæµå°è£…ä¸ºæµ‹è¯•æ¡ˆä¾‹ï¼Œå¤ç”¨åœ¨ä¸åŒåœºæ™¯ |
| **æµ‹è¯•è´Ÿè´£äºº** | ç»Ÿä¸€çš„æµ‹è¯•è§†å›¾ï¼Œæ— éœ€åŒºåˆ†"æµ‹è¯•"å’Œ"å·¥ä½œæµ" |
| **å¼€å‘å·¥ç¨‹å¸ˆ** | æ›´çœŸå®çš„ä¸šåŠ¡æµç¨‹æµ‹è¯•ï¼Œå‘ç°é›†æˆé—®é¢˜ |

---

## æ ¸å¿ƒè®¾è®¡åŸåˆ™

### åŸåˆ™1ï¼šæµ‹è¯•æ¡ˆä¾‹æ˜¯ç»Ÿä¸€å…¥å£

**ç†å¿µ**: ç”¨æˆ·çœ‹åˆ°çš„æ˜¯"æµ‹è¯•æ¡ˆä¾‹"ï¼Œè€Œä¸æ˜¯"æµ‹è¯•æ¡ˆä¾‹"å’Œ"å·¥ä½œæµ"ä¸¤ä¸ªæ¦‚å¿µã€‚

```
ç”¨æˆ·è§†è§’:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æµ‹è¯•æ¡ˆä¾‹åˆ—è¡¨                  â”‚
â”‚  - HTTPæµ‹è¯•ï¼šè·å–ç”¨æˆ·ä¿¡æ¯      â”‚
â”‚  - å‘½ä»¤æµ‹è¯•ï¼šæ£€æŸ¥æœåŠ¡çŠ¶æ€      â”‚
â”‚  - å·¥ä½œæµæµ‹è¯•ï¼šç”¨æˆ·æ³¨å†Œæµç¨‹    â”‚  â† å·¥ä½œæµä¹Ÿæ˜¯ä¸€ç§æµ‹è¯•
â”‚  - æ•°æ®åº“æµ‹è¯•ï¼šæŸ¥è¯¢è®¢å•        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŸåˆ™2ï¼šå·¥ä½œæµæ˜¯æµ‹è¯•ç±»å‹ä¹‹ä¸€

**æ‰©å±•Typeå­—æ®µ**:

```go
type TestCase struct {
    Type string `json:"type"`
    // å¯é€‰å€¼ï¼š
    // - "http"          å•ä¸€HTTPè¯·æ±‚
    // - "command"       å‘½ä»¤æ‰§è¡Œ
    // - "workflow"      å¤šæ­¥éª¤å·¥ä½œæµ  â† æ–°å¢
    // - "database"      æ•°æ®åº“æ“ä½œ
    // - "grpc"          gRPCè°ƒç”¨
    // ...
}
```

### åŸåˆ™3ï¼šåŒå‘å¼•ç”¨æ”¯æŒ

```
TestCase â†â†’ Workflow

æ¨¡å¼1: TestCase å¼•ç”¨ Workflow
{
  "type": "workflow",
  "workflowId": "wf-123"  // å¼•ç”¨ç‹¬ç«‹çš„å·¥ä½œæµ
}

æ¨¡å¼2: TestCase å†…åµŒ Workflow
{
  "type": "workflow",
  "workflowDef": { ... }  // å†…åµŒå·¥ä½œæµå®šä¹‰
}

æ¨¡å¼3: Workflow å¼•ç”¨ TestCase
workflow:
  steps:
    - type: test-case
      testId: "test-123"  // å¼•ç”¨æµ‹è¯•æ¡ˆä¾‹ä½œä¸ºæ­¥éª¤
```

### åŸåˆ™4ï¼šæ‰§è¡Œå¼•æ“ç»Ÿä¸€è°ƒåº¦

**ç»Ÿä¸€çš„æ‰§è¡Œå…¥å£**:

```go
// æ‰§è¡Œä»»ä½•æµ‹è¯•æ¡ˆä¾‹ï¼ˆåŒ…æ‹¬å·¥ä½œæµæµ‹è¯•ï¼‰
result := executor.ExecuteTest(testCase)

// å†…éƒ¨æ ¹æ®Typeè·¯ç”±åˆ°ä¸åŒçš„æ‰§è¡Œå™¨
switch testCase.Type {
case "http":
    return httpExecutor.Execute(testCase.HTTPConfig)
case "command":
    return commandExecutor.Execute(testCase.CommandConfig)
case "workflow":
    return workflowExecutor.Execute(testCase.WorkflowDef or testCase.WorkflowID)
}
```

---

## ä¸‰ç§é›†æˆæ¨¡å¼

### æ¨¡å¼1: æµ‹è¯•æ¡ˆä¾‹å¼•ç”¨å·¥ä½œæµ (æ¨èç”¨äºå¤æ‚åœºæ™¯)

#### ä½¿ç”¨åœºæ™¯

- ç«¯åˆ°ç«¯çš„ä¸šåŠ¡æµç¨‹æµ‹è¯•
- éœ€è¦å¤æ‚ç¼–æ’çš„æµ‹è¯•åœºæ™¯
- å·¥ä½œæµéœ€è¦ç‹¬ç«‹ç®¡ç†å’Œç‰ˆæœ¬æ§åˆ¶

#### æ•°æ®ç»“æ„

**æµ‹è¯•æ¡ˆä¾‹å®šä¹‰**:

```json
{
  "testId": "e2e-order-flow",
  "name": "å®Œæ•´è®¢å•æµç¨‹æµ‹è¯•",
  "type": "workflow",
  "priority": "P0",
  "tags": ["e2e", "critical", "order"],

  "workflowId": "workflow-order-v2.1",

  "timeout": 600,
  "assertions": [
    {
      "type": "workflow_success",
      "description": "å·¥ä½œæµå¿…é¡»æˆåŠŸå®Œæˆ"
    },
    {
      "type": "step_count",
      "expected": 5,
      "description": "åº”è¯¥æ‰§è¡Œ5ä¸ªæ­¥éª¤"
    }
  ]
}
```

**å¼•ç”¨çš„å·¥ä½œæµå®šä¹‰** (ç‹¬ç«‹å­˜å‚¨åœ¨ `workflows` è¡¨):

```yaml
workflow:
  id: workflow-order-v2.1
  name: è®¢å•å®Œæ•´æµç¨‹
  version: 2.1

  steps:
    - id: register
      name: æ³¨å†Œç”¨æˆ·
      type: http
      http:
        method: POST
        path: /api/users/register
      output:
        userId: "response.data.id"

    - id: login
      name: ç”¨æˆ·ç™»å½•
      type: http
      dependsOn: [register]
      # ... è¯¦ç»†é…ç½®

    - id: create-order
      name: åˆ›å»ºè®¢å•
      type: http
      dependsOn: [login]
      # ...

    - id: payment
      name: æ”¯ä»˜è®¢å•
      type: http
      dependsOn: [create-order]
      # ...

    - id: verify
      name: éªŒè¯è®¢å•çŠ¶æ€
      type: database
      dependsOn: [payment]
      # ...
```

#### ä¼˜ç‚¹

- å·¥ä½œæµå¯ä»¥ç‹¬ç«‹ç®¡ç†ï¼ˆç‰ˆæœ¬ã€ä¿®æ”¹ã€å¤ç”¨ï¼‰
- å¤šä¸ªæµ‹è¯•æ¡ˆä¾‹å¯ä»¥å¼•ç”¨åŒä¸€ä¸ªå·¥ä½œæµ
- æ¸…æ™°çš„èŒè´£åˆ†ç¦»ï¼ˆæµ‹è¯•æ¡ˆä¾‹ç®¡ç†æµ‹è¯•ï¼Œå·¥ä½œæµç®¡ç†æµç¨‹ï¼‰

#### æ‰§è¡Œæµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»æ‰§è¡Œæµ‹è¯• "e2e-order-flow"
   â†“
2. ç³»ç»Ÿè¯†åˆ« type=workflowï¼Œæå– workflowId
   â†“
3. ä» workflows è¡¨åŠ è½½å·¥ä½œæµå®šä¹‰
   â†“
4. WorkflowExecutor æ‰§è¡Œå·¥ä½œæµ
   â†“
5. æ‰§è¡Œç»“æœå­˜å‚¨åˆ° test_results è¡¨
   â†“
6. ç”¨æˆ·åœ¨æµ‹è¯•ç»“æœåˆ—è¡¨ä¸­æŸ¥çœ‹
```

---

### æ¨¡å¼2: æµ‹è¯•æ¡ˆä¾‹å†…åµŒå·¥ä½œæµ (æ¨èç”¨äºç®€å•åœºæ™¯)

#### ä½¿ç”¨åœºæ™¯

- ç®€å•çš„å¤šæ­¥éª¤æµ‹è¯•ï¼ˆ2-5æ­¥ï¼‰
- ä¸éœ€è¦å¤ç”¨çš„æµ‹è¯•æµç¨‹
- å¿«é€Ÿåˆ›å»ºæµ‹è¯•ï¼Œæ— éœ€ç®¡ç†ç‹¬ç«‹å·¥ä½œæµ

#### æ•°æ®ç»“æ„

**æµ‹è¯•æ¡ˆä¾‹å®šä¹‰** (å·¥ä½œæµå®šä¹‰å†…åµŒ):

```json
{
  "testId": "login-and-query",
  "name": "ç™»å½•åæŸ¥è¯¢ç”¨æˆ·æ•°æ®",
  "type": "workflow",
  "priority": "P1",
  "tags": ["auth", "integration"],

  "workflowDef": {
    "steps": [
      {
        "id": "login",
        "name": "ç”¨æˆ·ç™»å½•",
        "type": "http",
        "http": {
          "method": "POST",
          "path": "/api/auth/login",
          "body": {
            "username": "testuser",
            "password": "testpass"
          }
        },
        "assertions": [
          {"type": "status_code", "expected": 200}
        ],
        "output": {
          "token": "response.data.token"
        }
      },
      {
        "id": "query-user",
        "name": "æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯",
        "type": "http",
        "dependsOn": ["login"],
        "http": {
          "method": "GET",
          "path": "/api/users/me",
          "headers": {
            "Authorization": "Bearer ${login.token}"
          }
        },
        "assertions": [
          {"type": "status_code", "expected": 200},
          {"type": "json_path", "path": "data.username", "expected": "testuser"}
        ]
      }
    ]
  },

  "timeout": 60
}
```

#### ä¼˜ç‚¹

- æµ‹è¯•å®šä¹‰å®Œå…¨è‡ªåŒ…å«
- åˆ›å»ºç®€å•ï¼Œæ— éœ€é¢å¤–ç®¡ç†å·¥ä½œæµ
- é€‚åˆä¸€æ¬¡æ€§çš„æµ‹è¯•åœºæ™¯

#### ç¼ºç‚¹

- æ— æ³•å¤ç”¨å·¥ä½œæµå®šä¹‰
- ä¿®æ”¹éœ€è¦ç¼–è¾‘æµ‹è¯•æ¡ˆä¾‹
- ä¸é€‚åˆå¤æ‚çš„å·¥ä½œæµ

#### æ‰§è¡Œæµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»æ‰§è¡Œæµ‹è¯• "login-and-query"
   â†“
2. ç³»ç»Ÿè¯†åˆ« type=workflowï¼Œæå– workflowDef
   â†“
3. WorkflowExecutor ç›´æ¥æ‰§è¡Œå†…åµŒçš„å·¥ä½œæµå®šä¹‰
   â†“
4. æ‰§è¡Œç»“æœå­˜å‚¨åˆ° test_results è¡¨
```

---

### æ¨¡å¼3: å·¥ä½œæµå¼•ç”¨æµ‹è¯•æ¡ˆä¾‹ (å¤ç”¨å·²æœ‰æµ‹è¯•)

#### ä½¿ç”¨åœºæ™¯

- åœ¨å·¥ä½œæµä¸­å¤ç”¨å·²æœ‰çš„æµ‹è¯•æ¡ˆä¾‹
- ç»„åˆå¤šä¸ªç‹¬ç«‹æµ‹è¯•å½¢æˆæµç¨‹
- æµ‹è¯•æ¡ˆä¾‹éœ€è¦ç‹¬ç«‹ç»´æŠ¤

#### å·¥ä½œæµå®šä¹‰

```yaml
workflow:
  id: integration-test-flow
  name: é›†æˆæµ‹è¯•æµç¨‹

  steps:
    # å¼•ç”¨å·²æœ‰çš„æµ‹è¯•æ¡ˆä¾‹
    - id: test-user-create
      type: test-case
      testId: "api-user-create"  # å¼•ç”¨æµ‹è¯•æ¡ˆä¾‹
      name: æ‰§è¡Œç”¨æˆ·åˆ›å»ºæµ‹è¯•
      output:
        userId: "response.data.id"

    - id: test-user-login
      type: test-case
      testId: "api-user-login"
      dependsOn: [test-user-create]
      input:
        username: "${test-user-create.username}"
      output:
        token: "response.data.token"

    - id: test-order-create
      type: test-case
      testId: "api-order-create"
      dependsOn: [test-user-login]
      input:
        authToken: "${test-user-login.token}"

    # æ··åˆä½¿ç”¨ï¼šç›´æ¥å®šä¹‰çš„HTTPæ­¥éª¤
    - id: cleanup
      type: http
      dependsOn: [test-order-create]
      http:
        method: DELETE
        path: "/api/users/${test-user-create.userId}"
```

#### å¼•ç”¨çš„æµ‹è¯•æ¡ˆä¾‹

**æµ‹è¯•æ¡ˆä¾‹1: api-user-create**

```json
{
  "testId": "api-user-create",
  "name": "åˆ›å»ºç”¨æˆ·APIæµ‹è¯•",
  "type": "http",
  "http": {
    "method": "POST",
    "path": "/api/users",
    "body": {
      "username": "{{username}}",
      "email": "{{email}}"
    }
  },
  "assertions": [
    {"type": "status_code", "expected": 201},
    {"type": "json_path", "path": "data.id", "exists": true}
  ]
}
```

**æµ‹è¯•æ¡ˆä¾‹2: api-user-login**

```json
{
  "testId": "api-user-login",
  "name": "ç”¨æˆ·ç™»å½•APIæµ‹è¯•",
  "type": "http",
  "http": {
    "method": "POST",
    "path": "/api/auth/login",
    "body": {
      "username": "{{username}}",
      "password": "{{password}}"
    }
  },
  "assertions": [
    {"type": "status_code", "expected": 200},
    {"type": "json_path", "path": "data.token", "exists": true}
  ]
}
```

#### ä¼˜ç‚¹

- æµ‹è¯•æ¡ˆä¾‹ç‹¬ç«‹ç®¡ç†ï¼Œå¯ä»¥å•ç‹¬æ‰§è¡Œ
- å·¥ä½œæµå¤ç”¨å·²æœ‰çš„æµ‹è¯•é€»è¾‘
- æµ‹è¯•æ¡ˆä¾‹ä¿®æ”¹è‡ªåŠ¨åæ˜ åˆ°å·¥ä½œæµä¸­

#### Actionå®ç°

```go
// TestCaseAction - æ‰§è¡Œæµ‹è¯•æ¡ˆä¾‹çš„Action
type TestCaseAction struct {
    TestID string                 `json:"testId"`
    Input  map[string]interface{} `json:"input"`  // è¾“å…¥å˜é‡
}

func (a *TestCaseAction) Execute(ctx *ActionContext) (*ActionResult, error) {
    // 1. åŠ è½½æµ‹è¯•æ¡ˆä¾‹
    testCase, err := a.repo.GetTestCase(a.TestID)
    if err != nil {
        return nil, fmt.Errorf("failed to load test case: %w", err)
    }

    // 2. åº”ç”¨è¾“å…¥å˜é‡ï¼ˆå˜é‡æ›¿æ¢ï¼‰
    testCaseWithInput := a.applyInputVariables(testCase, ctx, a.Input)

    // 3. æ‰§è¡Œæµ‹è¯•æ¡ˆä¾‹
    result, err := a.executor.ExecuteTest(testCaseWithInput)
    if err != nil {
        return nil, fmt.Errorf("test case execution failed: %w", err)
    }

    // 4. è¿”å›ç»“æœ
    return &ActionResult{
        Status: result.Status,
        Output: result.Data,
        Error:  result.Error,
    }, nil
}
```

---

## æ•°æ®æ¨¡å‹è®¾è®¡

### 1. TestCase æ¨¡å‹æ‰©å±•

```go
// TestCase æµ‹è¯•æ¡ˆä¾‹æ¨¡å‹ï¼ˆæ‰©å±•ç‰ˆæœ¬ï¼‰
type TestCase struct {
    ID              uint           `gorm:"primaryKey" json:"id"`
    TestID          string         `gorm:"uniqueIndex;size:255;not null" json:"testId"`
    GroupID         string         `gorm:"size:255;not null;index" json:"groupId"`
    Name            string         `gorm:"size:255;not null" json:"name"`
    Type            string         `gorm:"size:50;not null;index" json:"type"`  // æ‰©å±•ï¼šå¢åŠ  "workflow"
    Priority        string         `gorm:"size:10;index" json:"priority"`
    Status          string         `gorm:"size:50;default:'active';index" json:"status"`
    Objective       string         `gorm:"type:text" json:"objective,omitempty"`
    Timeout         int            `gorm:"default:300" json:"timeout,omitempty"`

    // === æ–°å¢å­—æ®µï¼šå·¥ä½œæµæ”¯æŒ ===
    WorkflowID      string         `gorm:"size:255;index" json:"workflowId,omitempty"`  // å¼•ç”¨å·¥ä½œæµIDï¼ˆæ¨¡å¼1ï¼‰
    WorkflowDef     JSONB          `gorm:"type:text;column:workflow_def" json:"workflowDef,omitempty"`  // å†…åµŒå·¥ä½œæµå®šä¹‰ï¼ˆæ¨¡å¼2ï¼‰

    // === åŸæœ‰å­—æ®µä¿æŒä¸å˜ ===
    Preconditions     JSONArray  `gorm:"type:text" json:"preconditions,omitempty"`
    Steps             JSONArray  `gorm:"type:text" json:"steps,omitempty"`
    HTTPConfig        JSONB      `gorm:"type:text;column:http_config" json:"http,omitempty"`
    CommandConfig     JSONB      `gorm:"type:text;column:command_config" json:"command,omitempty"`
    DatabaseConfig    JSONB      `gorm:"type:text;column:database_config" json:"database,omitempty"`
    // ... å…¶ä»–é…ç½®å­—æ®µ ...

    Assertions        JSONArray  `gorm:"type:text" json:"assertions,omitempty"`
    Tags              JSONArray  `gorm:"type:text" json:"tags,omitempty"`

    SetupHooks        JSONArray  `gorm:"type:text;column:setup_hooks" json:"setupHooks,omitempty"`
    TeardownHooks     JSONArray  `gorm:"type:text;column:teardown_hooks" json:"teardownHooks,omitempty"`

    CreatedAt time.Time      `json:"createdAt"`
    UpdatedAt time.Time      `json:"updatedAt"`
    DeletedAt gorm.DeletedAt `gorm:"index" json:"-"`

    // å…³è”
    Group    *TestGroup    `gorm:"foreignKey:GroupID;references:GroupID" json:"-"`
    Workflow *Workflow     `gorm:"foreignKey:WorkflowID;references:WorkflowID" json:"-"`  // æ–°å¢
    Results  []TestResult  `gorm:"foreignKey:TestID;references:TestID" json:"-"`
}
```

### 2. Workflow æ¨¡å‹æ‰©å±•

```go
// Workflow å·¥ä½œæµæ¨¡å‹ï¼ˆæ‰©å±•ç‰ˆæœ¬ï¼‰
type Workflow struct {
    ID          uint      `gorm:"primaryKey" json:"id"`
    WorkflowID  string    `gorm:"uniqueIndex;size:255;not null" json:"workflowId"`
    Name        string    `gorm:"size:255;not null" json:"name"`
    Version     string    `gorm:"size:32" json:"version"`
    Description string    `gorm:"type:text" json:"description,omitempty"`
    Definition  JSONB     `gorm:"type:text;not null" json:"definition"`

    // === æ–°å¢å­—æ®µï¼šæµ‹è¯•æ¡ˆä¾‹å…³è” ===
    IsTestCase  bool      `gorm:"default:false;index" json:"isTestCase"`  // æ˜¯å¦è¢«æµ‹è¯•æ¡ˆä¾‹å¼•ç”¨

    CreatedAt   time.Time      `json:"createdAt"`
    UpdatedAt   time.Time      `json:"updatedAt"`
    DeletedAt   gorm.DeletedAt `gorm:"index" json:"-"`
    CreatedBy   string         `gorm:"size:64" json:"createdBy,omitempty"`

    // å…³è”
    TestCases []TestCase    `gorm:"foreignKey:WorkflowID;references:WorkflowID" json:"-"`  // æ–°å¢ï¼šåå‘å…³è”
    Runs      []WorkflowRun `gorm:"foreignKey:WorkflowID;references:WorkflowID" json:"-"`
}
```

### 3. æ•°æ®åº“è¿ç§»è„šæœ¬

```sql
-- æ‰©å±• test_cases è¡¨ï¼Œæ·»åŠ å·¥ä½œæµæ”¯æŒ
ALTER TABLE test_cases
ADD COLUMN workflow_id VARCHAR(255) DEFAULT NULL,
ADD COLUMN workflow_def TEXT DEFAULT NULL;

-- æ·»åŠ ç´¢å¼•
CREATE INDEX idx_test_cases_workflow_id ON test_cases(workflow_id);

-- æ‰©å±• workflows è¡¨ï¼Œæ·»åŠ æµ‹è¯•æ¡ˆä¾‹å…³è”æ ‡è®°
ALTER TABLE workflows
ADD COLUMN is_test_case BOOLEAN DEFAULT FALSE;

CREATE INDEX idx_workflows_is_test_case ON workflows(is_test_case);
```

---

## APIè®¾è®¡

### 1. æµ‹è¯•æ¡ˆä¾‹APIæ‰©å±•

#### åˆ›å»ºå·¥ä½œæµç±»å‹çš„æµ‹è¯•æ¡ˆä¾‹

**POST /api/v2/tests**

**æ¨¡å¼1: å¼•ç”¨å·¥ä½œæµ**

```json
{
  "testId": "e2e-order-flow",
  "name": "è®¢å•å®Œæ•´æµç¨‹æµ‹è¯•",
  "type": "workflow",
  "workflowId": "workflow-order-v2.1",
  "priority": "P0",
  "tags": ["e2e", "order"],
  "timeout": 600,
  "assertions": [
    {"type": "workflow_success"}
  ]
}
```

**æ¨¡å¼2: å†…åµŒå·¥ä½œæµ**

```json
{
  "testId": "login-query-test",
  "name": "ç™»å½•å¹¶æŸ¥è¯¢æ•°æ®",
  "type": "workflow",
  "workflowDef": {
    "steps": [
      {
        "id": "login",
        "type": "http",
        "http": { "method": "POST", "path": "/api/auth/login" },
        "output": { "token": "response.data.token" }
      },
      {
        "id": "query",
        "type": "http",
        "dependsOn": ["login"],
        "http": {
          "method": "GET",
          "path": "/api/data",
          "headers": { "Authorization": "Bearer ${login.token}" }
        }
      }
    ]
  },
  "priority": "P1"
}
```

#### æ‰§è¡Œå·¥ä½œæµæµ‹è¯•æ¡ˆä¾‹

**POST /api/v2/tests/:testId/execute**

```bash
POST /api/v2/tests/e2e-order-flow/execute
{
  "variables": {
    "env": "test",
    "baseUrl": "http://test-api.example.com"
  }
}
```

**å“åº”**:

```json
{
  "runId": "run-20251121-001",
  "testId": "e2e-order-flow",
  "status": "running",
  "workflowRunId": "wf-run-123",  // å…³è”çš„å·¥ä½œæµæ‰§è¡ŒID
  "startTime": "2025-11-21T10:30:00Z"
}
```

#### æŸ¥è¯¢å·¥ä½œæµæµ‹è¯•ç»“æœ

**GET /api/v2/tests/:testId/results/:resultId**

**å“åº”**:

```json
{
  "id": 123,
  "testId": "e2e-order-flow",
  "runId": "run-20251121-001",
  "status": "passed",
  "startTime": "2025-11-21T10:30:00Z",
  "endTime": "2025-11-21T10:35:30Z",
  "duration": 330000,

  "workflowRunId": "wf-run-123",

  "metrics": {
    "totalSteps": 5,
    "completedSteps": 5,
    "failedSteps": 0,
    "stepDetails": [
      {"stepId": "register", "status": "passed", "duration": 200},
      {"stepId": "login", "status": "passed", "duration": 150},
      {"stepId": "create-order", "status": "passed", "duration": 300},
      {"stepId": "payment", "status": "passed", "duration": 500},
      {"stepId": "verify", "status": "passed", "duration": 100}
    ]
  },

  "logs": [
    {"level": "info", "message": "Workflow execution started"},
    {"level": "info", "message": "Step 'register' completed successfully"},
    // ...
  ]
}
```

### 2. å·¥ä½œæµAPIæ‰©å±•

#### æŸ¥è¯¢å¼•ç”¨æŸä¸ªå·¥ä½œæµçš„æµ‹è¯•æ¡ˆä¾‹

**GET /api/v2/workflows/:workflowId/test-cases**

```bash
GET /api/v2/workflows/workflow-order-v2.1/test-cases
```

**å“åº”**:

```json
{
  "workflowId": "workflow-order-v2.1",
  "testCases": [
    {
      "testId": "e2e-order-flow",
      "name": "è®¢å•å®Œæ•´æµç¨‹æµ‹è¯•",
      "priority": "P0",
      "status": "active"
    },
    {
      "testId": "smoke-order-test",
      "name": "è®¢å•å†’çƒŸæµ‹è¯•",
      "priority": "P1",
      "status": "active"
    }
  ]
}
```

---

## æ‰§è¡Œå¼•æ“æ”¹é€ 

### ç»Ÿä¸€çš„æµ‹è¯•æ‰§è¡Œå™¨

```go
// UnifiedTestExecutor - ç»Ÿä¸€çš„æµ‹è¯•æ‰§è¡Œå™¨
type UnifiedTestExecutor struct {
    httpExecutor     *HTTPExecutor
    commandExecutor  *CommandExecutor
    workflowExecutor *WorkflowExecutor
    databaseExecutor *DatabaseExecutor
    // ...
}

func (e *UnifiedTestExecutor) ExecuteTest(testCase *models.TestCase) (*TestResult, error) {
    // è·¯ç”±åˆ°ä¸åŒçš„æ‰§è¡Œå™¨
    switch testCase.Type {
    case "http":
        return e.executeHTTPTest(testCase)

    case "command":
        return e.executeCommandTest(testCase)

    case "workflow":
        return e.executeWorkflowTest(testCase)  // æ–°å¢

    case "database":
        return e.executeDatabaseTest(testCase)

    default:
        return nil, fmt.Errorf("unsupported test type: %s", testCase.Type)
    }
}

func (e *UnifiedTestExecutor) executeWorkflowTest(testCase *models.TestCase) (*TestResult, error) {
    var workflow *models.Workflow
    var err error

    // æ¨¡å¼1ï¼šå¼•ç”¨å·¥ä½œæµ
    if testCase.WorkflowID != "" {
        workflow, err = e.workflowRepo.GetWorkflow(testCase.WorkflowID)
        if err != nil {
            return nil, fmt.Errorf("failed to load workflow: %w", err)
        }
    }

    // æ¨¡å¼2ï¼šå†…åµŒå·¥ä½œæµå®šä¹‰
    if testCase.WorkflowDef != nil {
        workflow = &models.Workflow{
            WorkflowID: fmt.Sprintf("inline-%s", testCase.TestID),
            Name:       testCase.Name,
            Definition: testCase.WorkflowDef,
        }
    }

    if workflow == nil {
        return nil, errors.New("no workflow definition found")
    }

    // æ‰§è¡Œå·¥ä½œæµ
    workflowResult, err := e.workflowExecutor.Execute(workflow)
    if err != nil {
        return nil, err
    }

    // è½¬æ¢ä¸ºæµ‹è¯•ç»“æœ
    testResult := &TestResult{
        TestID:        testCase.TestID,
        Status:        convertWorkflowStatusToTestStatus(workflowResult.Status),
        StartTime:     workflowResult.StartTime,
        EndTime:       workflowResult.EndTime,
        Duration:      workflowResult.Duration,
        WorkflowRunID: workflowResult.RunID,  // å…³è”å·¥ä½œæµæ‰§è¡ŒID
        Metrics: map[string]interface{}{
            "totalSteps":     workflowResult.TotalSteps,
            "completedSteps": workflowResult.CompletedSteps,
            "failedSteps":    workflowResult.FailedSteps,
            "stepDetails":    workflowResult.StepExecutions,
        },
        Logs: workflowResult.Logs,
    }

    return testResult, nil
}

func convertWorkflowStatusToTestStatus(workflowStatus string) string {
    switch workflowStatus {
    case "success":
        return "passed"
    case "failed":
        return "failed"
    case "cancelled":
        return "skipped"
    default:
        return "error"
    }
}
```

### TestCaseAction å®ç°ï¼ˆç”¨äºå·¥ä½œæµå¼•ç”¨æµ‹è¯•æ¡ˆä¾‹ï¼‰

```go
// TestCaseAction - åœ¨å·¥ä½œæµæ­¥éª¤ä¸­æ‰§è¡Œæµ‹è¯•æ¡ˆä¾‹
type TestCaseAction struct {
    TestID string                 `json:"testId"`
    Input  map[string]interface{} `json:"input,omitempty"`
}

func (a *TestCaseAction) Execute(ctx *ActionContext) (*ActionResult, error) {
    // 1. åŠ è½½æµ‹è¯•æ¡ˆä¾‹
    testCase, err := ctx.TestCaseRepo.GetTestCase(a.TestID)
    if err != nil {
        return nil, fmt.Errorf("test case not found: %s", a.TestID)
    }

    // 2. åº”ç”¨è¾“å…¥å˜é‡
    testCaseWithInput := a.applyInputVariables(testCase, ctx.Variables, a.Input)

    // 3. æ‰§è¡Œæµ‹è¯•æ¡ˆä¾‹
    result, err := ctx.Executor.ExecuteTest(testCaseWithInput)
    if err != nil {
        return &ActionResult{
            Status: "failed",
            Error:  err,
        }, nil
    }

    // 4. è¿”å›ç»“æœ
    return &ActionResult{
        Status: result.Status,
        Output: map[string]interface{}{
            "testId":   result.TestID,
            "status":   result.Status,
            "duration": result.Duration,
            "response": result.Data,  // HTTPå“åº”æ•°æ®ç­‰
        },
        Duration: result.Duration,
    }, nil
}

func (a *TestCaseAction) applyInputVariables(
    testCase *models.TestCase,
    contextVars map[string]interface{},
    inputMapping map[string]interface{},
) *models.TestCase {
    // å…‹éš†æµ‹è¯•æ¡ˆä¾‹
    cloned := *testCase

    // åº”ç”¨å˜é‡æ›¿æ¢åˆ°é…ç½®ä¸­
    // ä¾‹å¦‚ï¼šå°† {{authToken}} æ›¿æ¢ä¸ºå®é™…çš„tokenå€¼
    switch testCase.Type {
    case "http":
        cloned.HTTPConfig = a.replaceVariables(testCase.HTTPConfig, contextVars, inputMapping)
    case "command":
        cloned.CommandConfig = a.replaceVariables(testCase.CommandConfig, contextVars, inputMapping)
    // ...
    }

    return &cloned
}

func (a *TestCaseAction) replaceVariables(
    config models.JSONB,
    contextVars map[string]interface{},
    inputMapping map[string]interface{},
) models.JSONB {
    // å°†configåºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²
    configStr, _ := json.Marshal(config)
    str := string(configStr)

    // æ›¿æ¢ {{variableName}} å½¢å¼çš„å ä½ç¬¦
    for key, value := range inputMapping {
        placeholder := fmt.Sprintf("{{%s}}", key)
        str = strings.ReplaceAll(str, placeholder, fmt.Sprint(value))
    }

    // ååºåˆ—åŒ–å›JSONB
    var result models.JSONB
    json.Unmarshal([]byte(str), &result)
    return result
}

func (a *TestCaseAction) Validate() error {
    if a.TestID == "" {
        return errors.New("testId is required")
    }
    return nil
}

func (a *TestCaseAction) Metadata() ActionMetadata {
    return ActionMetadata{
        Type:        "test-case",
        Description: "Execute an existing test case",
        Category:    "testing",
    }
}
```

---

## å‰ç«¯UIè®¾è®¡

### 1. æµ‹è¯•æ¡ˆä¾‹åˆ—è¡¨ - æ˜¾ç¤ºå·¥ä½œæµç±»å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æµ‹è¯•æ¡ˆä¾‹åˆ—è¡¨                                [æ–°å»ºæµ‹è¯• â–¼]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åç§°                    ç±»å‹        ä¼˜å…ˆçº§  çŠ¶æ€    æ“ä½œ       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ğŸ“¡ è·å–ç”¨æˆ·åˆ—è¡¨          HTTP        P1     âœ… æ´»è·ƒ   æ‰§è¡Œ ç¼–è¾‘â”‚
â”‚  ğŸ’» æ£€æŸ¥æœåŠ¡çŠ¶æ€          Command     P2     âœ… æ´»è·ƒ   æ‰§è¡Œ ç¼–è¾‘â”‚
â”‚  ğŸ”€ ç”¨æˆ·æ³¨å†Œæµç¨‹         Workflow    P0     âœ… æ´»è·ƒ   æ‰§è¡Œ ç¼–è¾‘â”‚  â† å·¥ä½œæµæµ‹è¯•
â”‚  ğŸ”€ è®¢å•å®Œæ•´æµç¨‹         Workflow    P0     âœ… æ´»è·ƒ   æ‰§è¡Œ ç¼–è¾‘â”‚  â† å·¥ä½œæµæµ‹è¯•
â”‚  ğŸ—„ï¸ æŸ¥è¯¢è®¢å•æ•°æ®          Database    P1     âœ… æ´»è·ƒ   æ‰§è¡Œ ç¼–è¾‘â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ–°å»ºæµ‹è¯• - é€‰æ‹©ç±»å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–°å»ºæµ‹è¯•æ¡ˆä¾‹                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é€‰æ‹©æµ‹è¯•ç±»å‹:                          â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ“¡ HTTP       â”‚  â”‚  ğŸ’» Command   â”‚ â”‚
â”‚  â”‚  APIæ¥å£æµ‹è¯•   â”‚  â”‚  å‘½ä»¤æ‰§è¡Œ     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ”€ Workflow   â”‚  â”‚  ğŸ—„ï¸ Database  â”‚ â”‚  â† æ–°å¢
â”‚  â”‚  å·¥ä½œæµæµ‹è¯•    â”‚  â”‚  æ•°æ®åº“æ“ä½œ   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ” Security   â”‚  â”‚  âš¡ Performanceâ”‚ â”‚
â”‚  â”‚  å®‰å…¨æµ‹è¯•      â”‚  â”‚  æ€§èƒ½æµ‹è¯•     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. åˆ›å»ºå·¥ä½œæµæµ‹è¯• - æ¨¡å¼é€‰æ‹©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ›å»ºå·¥ä½œæµæµ‹è¯•                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åŸºæœ¬ä¿¡æ¯:                                              â”‚
â”‚  æµ‹è¯•ID: [e2e-order-flow               ]                â”‚
â”‚  åç§°:   [è®¢å•å®Œæ•´æµç¨‹æµ‹è¯•             ]                â”‚
â”‚  ä¼˜å…ˆçº§: [P0 â–¼]                                         â”‚
â”‚  æ ‡ç­¾:   [e2e, order, critical         ]                â”‚
â”‚                                                         â”‚
â”‚  å·¥ä½œæµé…ç½®:                                            â”‚
â”‚  â—‹ å¼•ç”¨å·²æœ‰å·¥ä½œæµ                                      â”‚
â”‚     é€‰æ‹©å·¥ä½œæµ: [workflow-order-v2.1 â–¼]                â”‚
â”‚                                                         â”‚
â”‚  â— å†…åµŒå·¥ä½œæµå®šä¹‰                                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚     â”‚ 1  steps:                               â”‚       â”‚
â”‚     â”‚ 2    - id: login                        â”‚       â”‚
â”‚     â”‚ 3      type: http                       â”‚       â”‚
â”‚     â”‚ 4      http:                            â”‚       â”‚
â”‚     â”‚ 5        method: POST                   â”‚       â”‚
â”‚     â”‚ 6        path: /api/auth/login          â”‚       â”‚
â”‚     â”‚ 7      output:                          â”‚       â”‚
â”‚     â”‚ 8        token: "response.data.token"   â”‚       â”‚
â”‚     â”‚ 9                                       â”‚       â”‚
â”‚     â”‚10    - id: query                        â”‚       â”‚
â”‚     â”‚11      type: http                       â”‚       â”‚
â”‚     â”‚12      dependsOn: [login]               â”‚       â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚     [YAMLç¼–è¾‘å™¨] [å¯è§†åŒ–ç¼–è¾‘å™¨]                        â”‚
â”‚                                                         â”‚
â”‚  [å–æ¶ˆ]                              [ä¿å­˜å¹¶æµ‹è¯• â†’]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. å·¥ä½œæµæµ‹è¯•ç»“æœå±•ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æµ‹è¯•ç»“æœ - è®¢å•å®Œæ•´æµç¨‹æµ‹è¯•                            â”‚
â”‚  çŠ¶æ€: âœ… é€šè¿‡  æ‰§è¡Œæ—¶é—´: 5åˆ†30ç§’                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ¦‚è§ˆ:                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æ€»æ­¥éª¤: 5ä¸ª                                    â”‚   â”‚
â”‚  â”‚  âœ… æˆåŠŸ: 5ä¸ª                                   â”‚   â”‚
â”‚  â”‚  âŒ å¤±è´¥: 0ä¸ª                                   â”‚   â”‚
â”‚  â”‚  â±ï¸ æ€»è€—æ—¶: 330ç§’                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  æ­¥éª¤è¯¦æƒ…:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âœ… 1. register - æ³¨å†Œç”¨æˆ·      (200ms)         â”‚   â”‚
â”‚  â”‚    Input: {username: "test_user_123"}           â”‚   â”‚
â”‚  â”‚    Output: {userId: 12345}                      â”‚   â”‚
â”‚  â”‚                                                 â”‚   â”‚
â”‚  â”‚ âœ… 2. login - ç”¨æˆ·ç™»å½•         (150ms)         â”‚   â”‚
â”‚  â”‚    Input: {userId: 12345}                       â”‚   â”‚
â”‚  â”‚    Output: {token: "eyJ..."}                    â”‚   â”‚
â”‚  â”‚                                                 â”‚   â”‚
â”‚  â”‚ âœ… 3. create-order - åˆ›å»ºè®¢å•  (300ms)         â”‚   â”‚
â”‚  â”‚    Input: {token: "eyJ..."}                     â”‚   â”‚
â”‚  â”‚    Output: {orderId: 67890}                     â”‚   â”‚
â”‚  â”‚                                                 â”‚   â”‚
â”‚  â”‚ âœ… 4. payment - æ”¯ä»˜è®¢å•       (500ms)         â”‚   â”‚
â”‚  â”‚    Input: {orderId: 67890, amount: 100}         â”‚   â”‚
â”‚  â”‚    Output: {paymentId: "PAY123"}                â”‚   â”‚
â”‚  â”‚                                                 â”‚   â”‚
â”‚  â”‚ âœ… 5. verify - éªŒè¯è®¢å•çŠ¶æ€    (100ms)         â”‚   â”‚
â”‚  â”‚    Input: {orderId: 67890}                      â”‚   â”‚
â”‚  â”‚    Output: {status: "completed"}                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  å˜é‡å¿«ç…§:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ userId: 12345                                   â”‚   â”‚
â”‚  â”‚ token: "eyJ..."                                 â”‚   â”‚
â”‚  â”‚ orderId: 67890                                  â”‚   â”‚
â”‚  â”‚ paymentId: "PAY123"                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  [æŸ¥çœ‹å®Œæ•´æ—¥å¿—] [å¯¼å‡ºæŠ¥å‘Š] [é‡æ–°æ‰§è¡Œ]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. å·¥ä½œæµè¯¦æƒ…é¡µ - æ˜¾ç¤ºå…³è”çš„æµ‹è¯•æ¡ˆä¾‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å·¥ä½œæµè¯¦æƒ… - è®¢å•å®Œæ•´æµç¨‹                              â”‚
â”‚  ID: workflow-order-v2.1  ç‰ˆæœ¬: 2.1                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åŸºæœ¬ä¿¡æ¯:                                              â”‚
â”‚  åç§°: è®¢å•å®Œæ•´æµç¨‹                                     â”‚
â”‚  æ­¥éª¤æ•°: 5ä¸ª                                            â”‚
â”‚  åˆ›å»ºæ—¶é—´: 2025-11-20 10:30                             â”‚
â”‚                                                         â”‚
â”‚  å…³è”çš„æµ‹è¯•æ¡ˆä¾‹: (2ä¸ª)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“‹ e2e-order-flow - è®¢å•å®Œæ•´æµç¨‹æµ‹è¯•    [æ‰§è¡Œ] â”‚   â”‚  â† å¼•ç”¨æ­¤å·¥ä½œæµ
â”‚  â”‚ ğŸ“‹ smoke-order-test - è®¢å•å†’çƒŸæµ‹è¯•      [æ‰§è¡Œ] â”‚   â”‚  â† å¼•ç”¨æ­¤å·¥ä½œæµ
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  å·¥ä½œæµå®šä¹‰: [æŸ¥çœ‹YAML] [å¯è§†åŒ–è§†å›¾]                   â”‚
â”‚                                                         â”‚
â”‚  æ‰§è¡Œå†å²: [æŸ¥çœ‹å…¨éƒ¨]                                   â”‚
â”‚  æœ€è¿‘5æ¬¡æ‰§è¡Œ:                                           â”‚
â”‚  - 2025-11-21 14:30  âœ… æˆåŠŸ  (5åˆ†20ç§’)                â”‚
â”‚  - 2025-11-21 10:15  âœ… æˆåŠŸ  (5åˆ†30ç§’)                â”‚
â”‚  - 2025-11-20 16:40  âŒ å¤±è´¥  (2åˆ†10ç§’) [æŸ¥çœ‹]         â”‚
â”‚                                                         â”‚
â”‚  [ç¼–è¾‘å·¥ä½œæµ] [åˆ é™¤] [å¯¼å‡º]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è¿ç§»æ–¹æ¡ˆ

### Phase 1: æ•°æ®æ¨¡å‹æ‰©å±• (Week 1)

**ç›®æ ‡**: æ‰©å±•æ•°æ®æ¨¡å‹ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½

**ä»»åŠ¡**:
1. âœ… æ•°æ®åº“è¿ç§»è„šæœ¬
   - æ·»åŠ  `test_cases.workflow_id` åˆ—
   - æ·»åŠ  `test_cases.workflow_def` åˆ—
   - æ·»åŠ  `workflows.is_test_case` åˆ—
   - åˆ›å»ºç´¢å¼•

2. âœ… æ›´æ–°GORMæ¨¡å‹
   - TestCase æ·»åŠ  WorkflowIDã€WorkflowDef å­—æ®µ
   - Workflow æ·»åŠ  IsTestCase å­—æ®µã€TestCases å…³è”

3. âœ… å‘åå…¼å®¹æµ‹è¯•
   - ç¡®ä¿ç°æœ‰æµ‹è¯•æ¡ˆä¾‹ CRUD æ­£å¸¸
   - ç¡®ä¿ç°æœ‰å·¥ä½œæµ CRUD æ­£å¸¸

**éªŒæ”¶æ ‡å‡†**:
- ç°æœ‰åŠŸèƒ½100%æ­£å¸¸è¿è¡Œ
- æ–°å­—æ®µå¯è¯»å†™ï¼Œä½†å°šæœªä½¿ç”¨

---

### Phase 2: æ‰§è¡Œå¼•æ“æ”¹é€  (Week 2-3)

**ç›®æ ‡**: å®ç°ç»Ÿä¸€çš„æµ‹è¯•æ‰§è¡Œå™¨

**ä»»åŠ¡**:
1. âœ… é‡æ„ TestExecutor
   - å®ç° UnifiedTestExecutor
   - è·¯ç”±åˆ°ä¸åŒçš„æ‰§è¡Œå™¨
   - æ·»åŠ  executeWorkflowTest æ–¹æ³•

2. âœ… å®ç° TestCaseAction
   - åœ¨å·¥ä½œæµä¸­å¼•ç”¨æµ‹è¯•æ¡ˆä¾‹
   - å˜é‡æ›¿æ¢æœºåˆ¶
   - è¾“å‡ºæ˜ å°„

3. âœ… æµ‹è¯•ç»“æœå­˜å‚¨
   - WorkflowRunID å…³è”
   - æ­¥éª¤è¯¦æƒ…å­˜å‚¨
   - å˜é‡å¿«ç…§å­˜å‚¨

**éªŒæ”¶æ ‡å‡†**:
- æ¨¡å¼1ï¼ˆå¼•ç”¨å·¥ä½œæµï¼‰å¯ä»¥æ‰§è¡Œ
- æ¨¡å¼2ï¼ˆå†…åµŒå·¥ä½œæµï¼‰å¯ä»¥æ‰§è¡Œ
- æ¨¡å¼3ï¼ˆå·¥ä½œæµå¼•ç”¨æµ‹è¯•ï¼‰å¯ä»¥æ‰§è¡Œ
- æµ‹è¯•ç»“æœå®Œæ•´è®°å½•

---

### Phase 3: APIæ‰©å±• (Week 4)

**ç›®æ ‡**: æä¾›å®Œæ•´çš„APIæ”¯æŒ

**ä»»åŠ¡**:
1. âœ… æµ‹è¯•æ¡ˆä¾‹API
   - POST /api/v2/tests - æ”¯æŒ type=workflow
   - GET /api/v2/tests/:id - è¿”å›å·¥ä½œæµä¿¡æ¯
   - POST /api/v2/tests/:id/execute - æ‰§è¡Œå·¥ä½œæµæµ‹è¯•

2. âœ… å·¥ä½œæµAPI
   - GET /api/v2/workflows/:id/test-cases - æŸ¥è¯¢å…³è”æµ‹è¯•
   - GET /api/v2/workflows/:id/usage - ä½¿ç”¨ç»Ÿè®¡

3. âœ… APIæ–‡æ¡£æ›´æ–°
   - Swagger/OpenAPIè§„èŒƒ
   - ç¤ºä¾‹ä»£ç 

**éªŒæ”¶æ ‡å‡†**:
- æ‰€æœ‰APIç«¯ç‚¹æ­£å¸¸å·¥ä½œ
- APIæ–‡æ¡£å®Œæ•´
- Postman collection å¯ç”¨

---

### Phase 4: å‰ç«¯UI (Week 5-6)

**ç›®æ ‡**: æä¾›å®Œæ•´çš„å‰ç«¯ç•Œé¢

**ä»»åŠ¡**:
1. âœ… æµ‹è¯•æ¡ˆä¾‹åˆ—è¡¨
   - æ˜¾ç¤ºå·¥ä½œæµç±»å‹å›¾æ ‡
   - å·¥ä½œæµæµ‹è¯•ç­›é€‰

2. âœ… åˆ›å»ºå·¥ä½œæµæµ‹è¯•
   - æ¨¡å¼é€‰æ‹©ï¼ˆå¼•ç”¨/å†…åµŒï¼‰
   - å·¥ä½œæµé€‰æ‹©å™¨
   - YAMLç¼–è¾‘å™¨

3. âœ… å·¥ä½œæµæµ‹è¯•ç»“æœ
   - æ­¥éª¤è¯¦æƒ…å±•ç¤º
   - å˜é‡å¿«ç…§å±•ç¤º
   - æ•°æ®æµå¯è§†åŒ–

4. âœ… å·¥ä½œæµè¯¦æƒ…é¡µ
   - å…³è”æµ‹è¯•æ¡ˆä¾‹åˆ—è¡¨
   - ä¸€é”®æ‰§è¡Œå…³è”æµ‹è¯•

**éªŒæ”¶æ ‡å‡†**:
- ç”¨æˆ·å¯ä»¥åˆ›å»ºå·¥ä½œæµæµ‹è¯•
- ç”¨æˆ·å¯ä»¥æ‰§è¡Œå·¥ä½œæµæµ‹è¯•
- ç”¨æˆ·å¯ä»¥æŸ¥çœ‹è¯¦ç»†ç»“æœ
- UIå“åº”æµç•…ï¼Œäº¤äº’æ¸…æ™°

---

### Phase 5: æ–‡æ¡£å’ŒåŸ¹è®­ (Week 7)

**ç›®æ ‡**: å®Œå–„æ–‡æ¡£ï¼ŒåŸ¹è®­ç”¨æˆ·

**ä»»åŠ¡**:
1. âœ… ç”¨æˆ·æ–‡æ¡£
   - å·¥ä½œæµæµ‹è¯•å¿«é€Ÿå¼€å§‹
   - ä¸‰ç§æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯
   - æœ€ä½³å®è·µ

2. âœ… ç¤ºä¾‹å’Œæ¨¡æ¿
   - 10ä¸ªå¸¸è§å·¥ä½œæµæµ‹è¯•ç¤ºä¾‹
   - æ¨¡æ¿åº“æ›´æ–°

3. âœ… åŸ¹è®­ææ–™
   - è§†é¢‘æ•™ç¨‹
   - åœ¨çº¿ç ”è®¨ä¼š

**éªŒæ”¶æ ‡å‡†**:
- æ–‡æ¡£å®Œæ•´ä¸”æ˜“æ‡‚
- ç”¨æˆ·å¯ä»¥è‡ªåŠ©å®Œæˆç®€å•åœºæ™¯
- åŸ¹è®­è¦†ç›–50%ä»¥ä¸Šç”¨æˆ·

---

## æ€»ç»“

### æ ¸å¿ƒè®¾è®¡æ€æƒ³

1. **ç»Ÿä¸€å…¥å£**: æµ‹è¯•æ¡ˆä¾‹æ˜¯ç”¨æˆ·çš„ç»Ÿä¸€å…¥å£ï¼Œå·¥ä½œæµæ˜¯å®ç°æ–¹å¼ä¹‹ä¸€
2. **åŒå‘å¼•ç”¨**: æµ‹è¯•æ¡ˆä¾‹å¯ä»¥å¼•ç”¨å·¥ä½œæµï¼Œå·¥ä½œæµä¹Ÿå¯ä»¥å¼•ç”¨æµ‹è¯•æ¡ˆä¾‹
3. **æ¨¡å¼çµæ´»**: ä¸‰ç§æ¨¡å¼è¦†ç›–ä¸åŒåœºæ™¯ï¼ˆç®€å•/å¤æ‚/å¤ç”¨ï¼‰
4. **æ‰§è¡Œç»Ÿä¸€**: ç»Ÿä¸€çš„æ‰§è¡Œå¼•æ“å’Œç»“æœå­˜å‚¨
5. **æ¸è¿›è¿ç§»**: åˆ†5ä¸ªé˜¶æ®µï¼Œæ¯é˜¶æ®µéƒ½å¯ç‹¬ç«‹äº¤ä»˜

### é¢„æœŸæ”¶ç›Š

| æŒ‡æ ‡ | å½“å‰ | ç›®æ ‡ | æå‡ |
|------|------|------|------|
| å¤æ‚æµ‹è¯•è¦†ç›– | æ— æ³•è¦†ç›–å¤šæ­¥éª¤æµç¨‹ | æ”¯æŒç«¯åˆ°ç«¯æµ‹è¯• | è´¨çš„é£è·ƒ |
| æµ‹è¯•å¤ç”¨ç‡ | ä½ï¼ˆæ¯ä¸ªæµ‹è¯•ç‹¬ç«‹ï¼‰ | é«˜ï¼ˆå·¥ä½œæµ+æµ‹è¯•ç»„åˆï¼‰ | 50%+ |
| ç”¨æˆ·å­¦ä¹ æˆæœ¬ | éœ€è¦ç†è§£"æµ‹è¯•"å’Œ"å·¥ä½œæµ"ä¸¤ä¸ªæ¦‚å¿µ | åªéœ€ç†è§£"æµ‹è¯•"ä¸€ä¸ªæ¦‚å¿µ | é™ä½30% |
| ç®¡ç†å¤æ‚åº¦ | åˆ†æ•£ç®¡ç† | ç»Ÿä¸€ç®¡ç† | é™ä½40% |

---

**æ–‡æ¡£ç»“æŸ**

**å˜æ›´å†å²**:
| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ |
|------|------|----------|
| 1.0 | 2025-11-21 | åˆå§‹ç‰ˆæœ¬ |
